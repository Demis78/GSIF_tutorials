library(rgdal)
library(plotKML)
data(SAGA_pal)
fw.path = utils::readRegistry("SOFTWARE\\WOW6432Node\\FWTools")$Install_Dir
gdalwarp = shQuote(shortPathName(normalizePath(file.path(fw.path, "bin/gdalwarp.exe"))))
gdalwarp
if(is.na(file.info("7za.exe")$size)){
  download.file("http://downloads.sourceforge.net/project/sevenzip/7-Zip/9.20/7za920.zip", destfile=paste(getwd(), "/", "7za920.zip", sep="")) 
  unzip("7za920.zip")
  unlink("7za920.zip")
}
si <- Sys.info()
si
aea.csy = "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=23 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"
download.file("http://worldgrids.org/lib/exe/fetch.php?media=tdmmod3a.tif.gz", "tdmmod3a.tif.gz")
system("7za e tdmmod3a.tif.gz")
GDALinfo("TDMMOD3a.tif")
cat(getURL("https://docs.google.com/spreadsheet/pub?key=0Ah5Ip0avaTkLdGd0RTJ4SGJVRU1IRWViYXN3WkhiaUE&single=true&gid=1&output=csv"), file="pnts.csv")
library(RCurl)
cat(getURL("https://docs.google.com/spreadsheet/pub?key=0Ah5Ip0avaTkLdGd0RTJ4SGJVRU1IRWViYXN3WkhiaUE&single=true&gid=1&output=csv"), file="pnts.csv")
curl <- getCurlHandle()
options(RCurlOptions = list(capath = system.file("CurlSSL", "cacert.pem", package = "RCurl"), ssl.verifypeer = FALSE))
curlSetOpt(.opts = list(proxy = 'proxyserver:port'), curl = curl)
cat(getURL("https://docs.google.com/spreadsheet/pub?key=0Ah5Ip0avaTkLdGd0RTJ4SGJVRU1IRWViYXN3WkhiaUE&single=true&gid=1&output=csv"), file="pnts.csv")
pnts <- read.csv("pnts.csv")
plot(pnts)
pnts
cat(getURL("https://docs.google.com/spreadsheet/pub?key=0Ah5Ip0avaTkLdGd0RTJ4SGJVRU1IRWViYXN3WkhiaUE&single=true&gid=1&output=csv"), file="pnts.csv")
pnts <- read.csv("pnts.csv")
pnts
cat(getURL("https://docs.google.com/spreadsheet/pub?key=0Ah5Ip0avaTkLdGd0RTJ4SGJVRU1IRWViYXN3WkhiaUE&single=true&gid=2&output=csv"), file="pnts.csv")
pnts <- read.csv("pnts.csv")
plot(pnts)
plot(pnts, asp=1)
coordinates(pnts) <- ~X+Y
proj4string(pnts) = CRS("+proj=longlat +datum=WGS84")
proj4string(pnts) = CRS(aea.csy)
pnts.ll <- spTransform(pnts, CRS("+proj=longlat +datum=WGS84"))
pnts.ll@bbox
library(raster)
TDMMOD3a <- raster("TDMMOD3a.tif")
TDMMOD3a
ov <- extract(TDMMOD3a, pnts.ll)
str(ov)
system(paste(gdalwarp, "TDMMOD3a.tif", "na_TDMMOD3a.tif", '-t_srs', paste('\"', aea.csy, '\"', sep=""), '-te', pnts@bbox[1,1], pnts@bbox[2,1], pnts@bbox[1,2], pnts@bbox[2,2], '-tr', 1000, 1000))
unlink("na_TDMMOD3a.tif")
system(paste(gdalwarp, "TDMMOD3a.tif", "na_TDMMOD3a.tif",'-te', pnts.ll@bbox[1,1], pnts.ll@bbox[2,1], pnts.ll@bbox[1,2], pnts.ll@bbox[2,2]))
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_5km.sdat', '-t_srs', paste('\"', aea.csy, '\"', sep=""), '-of SAGA', '-tr', 5000, 5000))
unlink("na_TDMMOD3a_5km.sdat")
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_5km.sdat', '-r near', '-t_srs', paste('\"', aea.csy, '\"', sep=""), '-of SAGA', '-tr', 5000, 5000))
na_TDMMOD3a_5km <- readGDAL("na_TDMMOD3a_5km.sdat")
image(na_TDMMOD3a_5km)
?raster
area(TDMMOD3a)
TDMMOD3a
resolution(TDMMOD3a)
res(TDMMOD3a)
unlink("na_TDMMOD3a_5km.sdat")
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_5km.sdat', '-r near', '-of SAGA', '-tr', res(TDMMOD3a)*5))
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_5km.sdat', '-r near', '-of SAGA', '-tr', paste(res(TDMMOD3a)*5), collapse=", "))
paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_5km.sdat', '-r near', '-of SAGA', '-tr', paste(res(TDMMOD3a)*5), collapse=", ")
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_5km.sdat', '-r near', '-of SAGA', '-tr', paste(res(TDMMOD3a)*5), sep=","))
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_5km.sdat', '-r near', '-of SAGA', '-tr', paste(res(TDMMOD3a)*5, sep=",")))
paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_5km.sdat', '-r near', '-of SAGA', '-tr', paste(res(TDMMOD3a)*5, sep=","))
paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_5km.sdat', '-r near', '-of SAGA', '-tr', res(TDMMOD3a)*5)
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_5km.sdat', '-r near', '-of SAGA', '-tr', res(TDMMOD3a)[1]*5, res(TDMMOD3a)[2]*5))
na_TDMMOD3a_5km <- readGDAL("na_TDMMOD3a_5km.sdat")
image(na_TDMMOD3a_5km)
unlink("na_TDMMOD3a_5km.sdat")
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_20km.sdat', '-r near', '-of SAGA', '-tr', res(TDMMOD3a)[1]*20, res(TDMMOD3a)[2]*20))
rm(na_TDMMOD3a_5km)
na_TDMMOD3a_20km <- readGDAL("na_TDMMOD3a_20km.sdat")
spplot(na_TDMMOD3a_20km, col.regions=SAGA_pal[[1]])
gdalwarp
TDMMOD3a <- raster("TDMMOD3a.tif")
TDMMOD3a
?extent
ext <- extent(-72, 70, 46.5, 48.5)
ext
x <- extent(TDMMOD3a, ext)
TDMMOD3a
x <- extent(TDMMOD3a, -72, 70, 46.5, 48.5)
x <- extent(TDMMOD3a, -72, -70, 46.5, 48.5)
ext <- extent(-72, 70, 46.5, 48.5)
x <- crop(TDMMOD3a, ext)
plot(x)
ext <- extent(-72, -70, 46.5, 48.5)
x <- crop(TDMMOD3a, ext)
plot(x)
plot(x, col=SAGA_pal[[1]])
TDMMOD3a <- raster("TDMMOD3a.tif")
TDMMOD3a
ext <- extent(-72, -70, 46.5, 48.5)
x <- crop(TDMMOD3a, ext)
x
library(GSIF)
tl <- getSpatialTiles(TDMMOD3a, block.x=20)
?getSpatialTiles
tl <- getSpatialTiles(as(x, "SpatialPixelsDataFrame"), block.x=1)
lines(tl)
plot(x, col=SAGA_pal[[1]])
lines(tl)
class(tl)
lines(as(tl, "SpatialLines"))
q()
library(rgdal)
library(plotKML)
library(RCurl)
library(raster)
data(SAGA_pal)
library(GSIF)
fw.path = utils::readRegistry("SOFTWARE\\WOW6432Node\\FWTools")$Install_Dir
gdalwarp = shQuote(shortPathName(normalizePath(file.path(fw.path, "bin/gdalwarp.exe"))))
gdalwarp
si <- Sys.info()
si
aea.csy = "+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=23 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"
system("7za e tdmmod3a.tif.gz")
GDALinfo("TDMMOD3a.tif")
gc()
curl <- getCurlHandle()
options(RCurlOptions = list(capath = system.file("CurlSSL", "cacert.pem", package = "RCurl"), ssl.verifypeer = FALSE))
curlSetOpt(.opts = list(proxy = 'proxyserver:port'), curl = curl)
cat(getURL("https://docs.google.com/spreadsheet/pub?key=0Ah5Ip0avaTkLdGd0RTJ4SGJVRU1IRWViYXN3WkhiaUE&single=true&gid=2&output=csv"), file="pnts.csv")
pnts <- read.csv("pnts.csv")
plot(pnts, asp=1)
coordinates(pnts) <- ~X+Y
proj4string(pnts) = CRS(aea.csy)
pnts.ll <- spTransform(pnts, CRS("+proj=longlat +datum=WGS84"))
pnts.ll@bbox
TDMMOD3a <- raster("TDMMOD3a.tif")
TDMMOD3a
ext <- extent(-72, -70, 46.5, 48.5)
ext
str(ext)
x <- crop(TDMMOD3a, ext)
x
plot(x, col=SAGA_pal[[1]])
tl <- getSpatialTiles(as(x, "SpatialPixelsDataFrame"), block.x=1)
lines(as(tl, "SpatialLines"))
?crop
ov <- extract(TDMMOD3a, pnts.ll)
str(ov)
unlink("na_TDMMOD3a.tif")
system(paste(gdalwarp, 'TDMMOD3a.tif', 'na_TDMMOD3a.tif', '-te', pnts.ll@bbox[1,1], pnts.ll@bbox[2,1], pnts.ll@bbox[1,2], pnts.ll@bbox[2,2]))
unlink("na_TDMMOD3a_20km.sdat")
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_20km.sdat', '-r near', '-of SAGA', '-tr', res(TDMMOD3a)[1]*20, res(TDMMOD3a)[2]*20))
na_TDMMOD3a_20km <- readGDAL("na_TDMMOD3a_20km.sdat")
spplot(na_TDMMOD3a_20km, col.regions=SAGA_pal[[1]])
TDMMOD3a <- raster("TDMMOD3a.tif")
ext <- extent(-72, -70, 46.5, 48.5)
x <- crop(TDMMOD3a, ext)
plot(x, col=SAGA_pal[[1]])
GDALinfo("TDMMOD3a.tif")
pep <- readOGR("casestudy\\Forest\\Plots\\PermanentPlots\\pep.shp")
q()
library(rgdal)
library(plotKML)
library(RCurl)
library(raster)
data(SAGA_pal)
library(splines)
library(nlme)
cal <- read.csv("cal.csv")
coordinates(cal) <- ~LON+LAT
proj4string(cal) = CRS("+proj=longlat +datum=WGS84")
cal.xy <- spTransform(cal, CRS(aea.csy))
cal.xy$LON <- cal@coords[,1]
cal.xy$LAT <- cal@coords[,2]
ov <- extract(TDMMOD3a, cal)
cal.xy$TDMMOD3a <- ov
sel = cal.xy@coords[,1] > pnts@bbox[1,1] & cal.xy@coords[,1] < pnts@bbox[1,2] & cal.xy@coords[,2] > pnts@bbox[2,1] & cal.xy@coords[,2] < pnts@bbox[2,2]
cal.xy <- cal.xy[sel,]
cal.xy <- remove.duplicates(cal.xy)
pairs(TEMPC~TDMMOD3a+LAT+LON, cal.xy)
save.image("D:\\GSIF\\code\\trunk\\largeRaster\\.RData")
TEMPC.m <- lm(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), cal.xy)
summary(TEMPC.m)
cal.xy$res <- residuals(TEMPC.m)
svar <- vgm(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), cal.xy)
library(gstat)
svar <- vgm(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), cal.xy)
?vgm
svar <- variogram(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), cal.xy)
svar <- variogram(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), cal.xy[-TEMPC.m$na.action,])
plot(svar)
TEMPC.vgm <- fit.variogram(svar, vgm(nugget=5, model="Lin"))
plot(svar, TEMPC.vgm)
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), cal.xy[-TEMPC.m$na.action,], TEMPC.vgm)
?krige
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), locations=cal.xy[-TEMPC.m$na.action,], newdata=pnts, TEMPC.vgm)
str(pnts)
newdata = data.frame(pnts)
names(newdata) <- c("LON", "LAT")
str(newdata)
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), locations=cal.xy[-TEMPC.m$na.action,], newdata=newdata, TEMPC.vgm)
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), locations=cal.xy[-TEMPC.m$na.action,], newdata=pnts, TEMPC.vgm)
plot(pnts, asp=1)
pnts <- read.csv("pnts.csv")
names(pnts)
names(pnts) <- c("LON", "LAT")
coordinates(pnts) <- ~LON+LAT
proj4string(pnts) = CRS(aea.csy)
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), locations=cal.xy[-TEMPC.m$na.action,], newdata=pnts, TEMPC.vgm)
ov <- extract(TDMMOD3a, spTransform(pnts, CRS("+proj=longlat +datum=WGS84")))
pnts.ll <- spTransform(pnts, CRS("+proj=longlat +datum=WGS84"))
pnts$TDMMOD3a <- ov
str(ov)
pnts@bbox
str(pnts)
pnts.xy <- SpatialPointsDataFrame(pnts, data.frame(TDMMOD3a = ov, LON = pnts.ll@coords[,1], LAT = pnts.ll@coords[,2]))
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), locations=cal.xy[-TEMPC.m$na.action,], newdata=pnts.xy, TEMPC.vgm)
str(TEMPC.uk)
spplot(TEMPC.uk["var1.pred"])
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), locations=cal.xy[-TEMPC.m$na.action,], newdata=pnts.xy, TEMPC.vgm)
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), locations=cal.xy[-TEMPC.m$na.action,], newdata=pnts.xy, TEMPC.vgm, nmax=60, nmin=20)
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), locations=cal.xy[-TEMPC.m$na.action,], newdata=pnts.xy, TEMPC.vgm, nmax=60, nmin=40)
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), locations=cal.xy[-TEMPC.m$na.action,], newdata=pnts.xy, TEMPC.vgm)
svar <- variogram(TEMPC~TDMMOD3a*LAT+ns(LON, df = 5), cal.xy[-TEMPC.m$na.action,])
plot(svar)
TEMPC.vgm <- fit.variogram(svar, vgm(nugget=5, model="Lin"))
plot(svar, TEMPC.vgm)
cat(getURL("https://docs.google.com/spreadsheet/pub?key=0Ah5Ip0avaTkLdGd0RTJ4SGJVRU1IRWViYXN3WkhiaUE&single=true&gid=3&output=csv"), file="preds.csv")
curl <- getCurlHandle()
options(RCurlOptions = list(capath = system.file("CurlSSL", "cacert.pem", package = "RCurl"), ssl.verifypeer = FALSE))
curlSetOpt(.opts = list(proxy = 'proxyserver:port'), curl = curl)
cat(getURL("https://docs.google.com/spreadsheet/pub?key=0Ah5Ip0avaTkLdGd0RTJ4SGJVRU1IRWViYXN3WkhiaUE&single=true&gid=3&output=csv"), file="preds.csv")
preds <- read.csv("preds.csv")
preds$TomHengl <- TEMPC.uk$var1.pred
lapply(preds[,5:14], function(x){sqrt(mean((preds$Measured - x)^2, na.rm = TRUE))}) 
pairs(TEMPC~TDMMOD3a+LAT+LON, cal.xy)
TEMPC.m <- lm(TEMPC~TDMMOD3a*LAT, cal.xy)
summary(TEMPC.m)
svar <- variogram(TEMPC~TDMMOD3a*LAT, cal.xy[-TEMPC.m$na.action,])
plot(svar)
TEMPC.vgm <- fit.variogram(svar, vgm(nugget=5, model="Lin"))
plot(svar, TEMPC.vgm)
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT, locations=cal.xy[-TEMPC.m$na.action,], newdata=pnts.xy, TEMPC.vgm)
preds$TomHengl <- TEMPC.uk$var1.pred
lapply(preds[,5:14], function(x){sqrt(mean((preds$Measured - x)^2, na.rm = TRUE))}) 
spplot(TEMPC.uk[1], col.regions=SAGA_pal[[1]])
points(cal.xy, pch="+")
plot(TEMPC.uk[1], col.regions=SAGA_pal[[1]], pch=19)
plot(TEMPC.uk[1], col=SAGA_pal[[1]], pch=19)
points(cal.xy, pch="+", add=TRUE)
spplot(TEMPC.uk[1], col.regions=SAGA_pal[[1]])
points(cal.xy, pch="+", add=TRUE)
spplot(TEMPC.uk[1], col.regions=SAGA_pal[[1]], sp.layout=list("sp.points", cal.xy, pch="+"))
spplot(TEMPC.uk[1], col.regions=SAGA_pal[[1]], sp.layout=list("sp.points", cal.xy, pch="+", col="black"))
preds$TomHengl <- TEMPC.uk$var1.pred
lapply(preds[,5:14], function(x){sqrt(mean((preds$Measured - x)^2, na.rm = TRUE))}) 
m = TEMPC~TDMMOD3a*LAT
TEMPC.m <- lm(m, cal.xy)
summary(TEMPC.m)
TEMPC.uk.cv <- krige.cv(TEMPC~TDMMOD3a*LAT, locations=cal.xy[-TEMPC.m$na.action,], TEMPC.vgm, nfold=5)
str(TEMPC.uk.cv@data)
sqrt(mean((TEMPC.uk.cv$var1.pred - TEMPC.uk.cv$observed)^2, na.rm = TRUE))
TEMPC.uk.cv <- krige.cv(TEMPC~TDMMOD3a*LAT, locations=cal.xy[-TEMPC.m$na.action,], TEMPC.vgm, nfold=5)
sqrt(mean((TEMPC.uk.cv$var1.pred - TEMPC.uk.cv$observed)^2, na.rm = TRUE))
spplot(TEMPC.uk.cv["zscore"])
spplot(TEMPC.uk.cv["zscore"], col.regions=SAGA_pal[[1]])
sel2 <- TEMPC.uk.cv$zscore < 6 & TEMPC.uk.cv$zscore > -6
TEMPC.vgm <- fit.variogram(variogram(TEMPC~TDMMOD3a*LAT, cal.xy[-TEMPC.m$na.action & sel2,]), vgm(nugget=5, model="Lin"))
TEMPC.vgm <- fit.variogram(variogram(TEMPC~TDMMOD3a*LAT, cal.xy[-TEMPC.m$na.action,][sel2]), vgm(nugget=5, model="Lin"))
TEMPC.vgm <- fit.variogram(variogram(TEMPC~TDMMOD3a*LAT, cal.xy[-TEMPC.m$na.action,][sel2,]), vgm(nugget=5, model="Lin"))
svar <- variogram(TEMPC~TDMMOD3a*LAT, cal.xy[-TEMPC.m$na.action,][sel2,])
TEMPC.vgm <- fit.variogram(svar, vgm(nugget=5, model="Lin"))
plot(svar, TEMPC.vgm)
TEMPC.vgm <- fit.variogram(svar, vgm(nugget=5, model="Exp"))
TEMPC.vgm <- fit.variogram(svar, vgm(nugget=5, model="Exp", range=2e5))
plot(svar, TEMPC.vgm)
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT, locations=cal.xy[-TEMPC.m$na.action,][sel2,], newdata=pnts.xy, TEMPC.vgm)
preds$TomHengl <- TEMPC.uk$var1.pred
lapply(preds[,5:14], function(x){sqrt(mean((preds$Measured - x)^2, na.rm = TRUE))}) 
pairs(TEMPC~TDMMOD3a+LAT+LON, cal.xy)
m = TEMPC~TDMMOD3a*LAT
TEMPC.m <- lm(m, cal.xy)
summary(TEMPC.m)
download.file("http://worldgrids.org/lib/exe/fetch.php?media=tdmmod3a.tif.gz", "tdlmod3a.tif.gz")
system("7za e tdmmod3a.tif.gz"); system("7za e tdlmod3a.tif.gz")
system("7za e tdlmod3a.tif.gz")
download.file("http://worldgrids.org/lib/exe/fetch.php?media=tdlmod3a.tif.gz", "tdlmod3a.tif.gz")
system("7za e tdlmod3a.tif.gz")
ov2 <- extract(raster("TDLMOD3a.tif"), pnts.ll)
pnts.xy <- SpatialPointsDataFrame(pnts, data.frame(TDMMOD3a = ov, TDLMOD3a = ov2, LON = pnts.ll@coords[,1], LAT = pnts.ll@coords[,2]))
w.l <- c("tdmmod3a.tif", "tdlmod3a.tif")
j=1
if(is.na(file.info(w.l[j])$size))
)
is(is.na(file.info(w.l[j])$size))
is.na(file.info(w.l[j])$size)
file.info(w.l[j])$size
system("7za e td*mod3a.tif.gz")
pnts.xy <- SpatialPointsDataFrame(pnts, data.frame(TDMMOD3a = ov, TDLMOD3a = ov2, LON = pnts.ll@coords[,1], LAT = pnts.ll@coords[,2]))
TDLMOD3a <- raster("TDLMOD3a.tif")
ov <- extract(TDMMOD3a, cal)
cal.xy <- spTransform(cal, CRS(aea.csy))
cal.xy$LON <- cal@coords[,1]
cal.xy$LAT <- cal@coords[,2]
sel = cal.xy@coords[,1] > pnts@bbox[1,1] & cal.xy@coords[,1] < pnts@bbox[1,2] & cal.xy@coords[,2] > pnts@bbox[2,1] & cal.xy@coords[,2] < pnts@bbox[2,2]
cal.xy <- cal.xy[sel,]
ov <- extract(TDMMOD3a, cal[sel,])
ov2 <- extract(TDLMOD3a, cal[sel,])
cal.xy$TDMMOD3a <- ov
cal.xy$TDLMOD3a <- ov2
cal.xy <- remove.duplicates(cal.xy)
pairs(TEMPC~TDMMOD3a+LAT+LON, cal.xy)
pairs(TEMPC~TDMMOD3a+TDLMOD3a+LAT, cal.xy)
m = TEMPC~TDMMOD3a*LAT*TDLMOD3a
TEMPC.m <- lm(m, cal.xy)
summary(TEMPC.m)
svar <- variogram(TEMPC~TDMMOD3a*LAT*TDLMOD3a, cal.xy[-TEMPC.m$na.action,])
plot(svar)
TEMPC.vgm <- fit.variogram(svar, vgm(nugget=5, model="Lin"))
TEMPC.vgm <- fit.variogram(svar, vgm(nugget=5, model="Exp", range=2e5))
plot(svar, TEMPC.vgm)
TEMPC.vgm <- fit.variogram(svar, vgm(nugget=5, model="Lin"))
plot(svar, TEMPC.vgm)
TEMPC.uk.cv <- krige.cv(TEMPC~TDMMOD3a*LAT, locations=cal.xy[-TEMPC.m$na.action,], TEMPC.vgm, nfold=5)
spplot(TEMPC.uk.cv["zscore"], col.regions=SAGA_pal[[1]]) ## difficult model
sqrt(mean((TEMPC.uk.cv$var1.pred - TEMPC.uk.cv$observed)^2, na.rm = TRUE))
TEMPC.uk <- krige(TEMPC~TDMMOD3a*LAT, locations=cal.xy[-TEMPC.m$na.action,][sel2,], newdata=pnts.xy, TEMPC.vgm)
preds$TomHengl <- TEMPC.uk$var1.pred
lapply(preds[,5:14], function(x){sqrt(mean((preds$Measured - x)^2, na.rm = TRUE))}) 
m = TEMPC~TDMMOD3a+TDLMOD3a+LAT
TEMPC.m <- lm(m, cal.xy)
summary(TEMPC.m)
svar <- variogram(m, cal.xy[-TEMPC.m$na.action,])
plot(svar)
TEMPC.vgm <- fit.variogram(svar, vgm(nugget=5, model="Lin"))
plot(svar, TEMPC.vgm)
TEMPC.uk.cv <- krige.cv(TEMPC~TDMMOD3a*LAT, locations=cal.xy[-TEMPC.m$na.action,], TEMPC.vgm, nfold=5)
TEMPC.uk.cv <- krige.cv(m, locations=cal.xy[-TEMPC.m$na.action,], TEMPC.vgm, nfold=5)
summary(TEMPC.m)
sqrt(mean((TEMPC.uk.cv$var1.pred - TEMPC.uk.cv$observed)^2, na.rm = TRUE))
TEMPC.uk <- krige(m, locations=cal.xy[-TEMPC.m$na.action,][sel2,], newdata=pnts.xy, TEMPC.vgm)
preds$TomHengl <- TEMPC.uk$var1.pred
lapply(preds[,5:14], function(x){sqrt(mean((preds$Measured - x)^2, na.rm = TRUE))}) 
pairs(TEMPC~TDMMOD3a+TDLMOD3a+LAT+LON, cal.xy)
m = TEMPC~TDMMOD3a*TDLMOD3a*LAT+ns(LON, df=5)
TEMPC.m <- lm(m, cal.xy)
summary(TEMPC.m)
svar <- variogram(m, cal.xy[-TEMPC.m$na.action,])
plot(svar)
TEMPC.vgm <- fit.variogram(svar, vgm(nugget=5, model="Lin"))
plot(svar, TEMPC.vgm)
TEMPC.uk.cv <- krige.cv(m, locations=cal.xy[-TEMPC.m$na.action,], TEMPC.vgm, nfold=5)
sqrt(mean((TEMPC.uk.cv$var1.pred - TEMPC.uk.cv$observed)^2, na.rm = TRUE))
TEMPC.uk <- krige(m, locations=cal.xy[-TEMPC.m$na.action,], newdata=pnts.xy, TEMPC.vgm)
preds$TomHengl <- TEMPC.uk$var1.pred
lapply(preds[,5:14], function(x){sqrt(mean((preds$Measured - x)^2, na.rm = TRUE))}) 
spplot(na_TDMMOD3a_20km, col.regions=SAGA_pal[[1]])
TEMPC.m <- step(TEMPC.m)
summary(TEMPC.m)
TEMPC.m <- lm(m, cal.xy)
summary(TEMPC.m)
pairs(TEMPC~TDMMOD3a+TDLMOD3a+LAT+LON, cal.xy)
spplot(na_TDMMOD3a_20km, col.regions=SAGA_pal[[1]])
unlink("na_TDMMOD3a.tif")
system(paste(gdalwarp, 'TDMMOD3a.tif', 'na_TDMMOD3a.tif', '-dstnodata -99999', '-te', pnts.ll@bbox[1,1], pnts.ll@bbox[2,1], pnts.ll@bbox[1,2], pnts.ll@bbox[2,2]))
unlink("na_TDMMOD3a_20km.sdat")
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_20km.sdat', '-r near', '-dstnodata -99999', '-of SAGA', '-tr', res(TDMMOD3a)[1]*20, res(TDMMOD3a)[2]*20))
na_TDMMOD3a_20km <- readGDAL("na_TDMMOD3a_20km.sdat")
spplot(na_TDMMOD3a_20km, col.regions=SAGA_pal[[1]])
unlink("na_TDMMOD3a_20km.sdat")
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_20km.sdat', '-r near', '-dstnodata -32768', '-of SAGA', '-tr', res(TDMMOD3a)[1]*20, res(TDMMOD3a)[2]*20))
na_TDMMOD3a_20km <- readGDAL("na_TDMMOD3a_20km.sdat")
spplot(na_TDMMOD3a_20km, col.regions=SAGA_pal[[1]])
trObjSearch(path=.trPaths[2])
unlink("na_TDMMOD3a_20km.sdat")
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_20km.sdat', '-r near', '-srcnodata -32768', '-of SAGA', '-tr', res(TDMMOD3a)[1]*20, res(TDMMOD3a)[2]*20))
na_TDMMOD3a_20km <- readGDAL("na_TDMMOD3a_20km.sdat")
spplot(na_TDMMOD3a_20km, col.regions=SAGA_pal[[1]])
unlink("na_TDMMOD3a_20km.sdat")
system(paste(gdalwarp, 'na_TDMMOD3a.tif', 'na_TDMMOD3a_20km.sdat', '-r near', '-srcnodata -32768', '-dstnodata -99999', '-of SAGA', '-tr', res(TDMMOD3a)[1]*20, res(TDMMOD3a)[2]*20))
na_TDMMOD3a_20km <- readGDAL("na_TDMMOD3a_20km.sdat")
spplot(na_TDMMOD3a_20km, col.regions=SAGA_pal[[1]])
lapply(preds[,5:14], function(x){sqrt(mean((preds$Measured - x)^2, na.rm = TRUE))}) 
unlink("TDMMOD3a.tif")
unlink("TDLMOD3a.tif")
q()
